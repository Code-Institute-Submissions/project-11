<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Index</title>

	<!-- Bootstrap js files -->
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
		integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
		integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
	</script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
	</script>

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
		integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<!-- dc CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.min.css" type="text/css" />
	<!-- d3 charting library -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.1/d3.min.js"
		integrity="sha256-SQJ/nCYPXFPuqoS56EfnesDBPNiitndOIfN2WdPRi/o=" crossorigin="anonymous"></script>
	<!-- Crossfilter charting library -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"
		integrity="sha256-T9tvV3x+/vCnCoFciKNZwbaJ46q9lh6iZjD0ZjD95lE=" crossorigin="anonymous"></script>
	<!-- dc charting library -->

	<script src="https://cdnjs.cloudflare.com/ajax/libs/dc/3.2.1/dc.min.js"
		integrity="sha256-g36jGLL708D9oZr5QHvv1KB0lnMupwfKDFK2nTK+PD0=" crossorigin="anonymous"></script>
	<!-- queue charting library -->
	<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js" integrity="sha256-wvO537iwaZblh5EKbL0aQlyjjtADksAZ1fqH/U0zdmA=" crossorigin="anonymous"></script>-->
	<!--My JavaScript link-------------->
	<!--<script type="text/javascript" src="js/main2.js"></script>-->
	<!--My css link-------------->
	<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>
	<a href="index.html">Visit index.html</a>

	<!--Chart 1-->
	<div id="nameType">
		<strong>Name</strong>
		<span class="reset" style="display: none;">selected: <span class="filter"></span></span>
		<a class="reset" href="javascript:nameChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
		<div class="clearfix"></div>
	</div>

	<!--Chart 2-->
	<div id="opponentType">
		<strong>Opponent</strong>
		<span class="reset" style="display: none;">selected: <span class="filter"></span></span>
		<a class="reset" href="javascript:opponentChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
		<div class="clearfix"></div>
	</div>

	<!--Chart Table-->
	<div>
		<div class="dc-data-count">
			<span class="filter-count"></span> selected out of <span class="total-count"></span> records | <a
				href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
		</div>
	</div>
	<table class="table table-hover dc-data-table">
	</table>
	<script>
		const nameChart = dc.rowChart("#nameType");
        const opponentChart = dc.rowChart("#opponentType");
        const visCount = dc.dataCount(".dc-data-count");
        const visTable = dc.dataTable(".dc-data-table");

    //Get data
    d3.json('data/stats.json').then(function (data, err) {
        if (err) throw err;
        console.log(data);

        //Parse the date
        const dateFormatSpecifier = '%d/%m/%Y';
        //const dateFormat = d3.timeFormat(dateFormatSpecifier);
        const dateFormatParser = d3.timeParse(dateFormatSpecifier);
        //const numberFormat = d3.format('.2f');

        data.forEach(d => {
            d.date = dateFormatParser(d.date);
            //console.log(d.date);
        });

        //Create the crossfilter
        const ndx = crossfilter(data);
        const all = ndx.groupAll();

        const nameDim = ndx.dimension(function (d) { return d.name; });
        const opponentDim = ndx.dimension(function (d) { return d.opponent; });
        const dateDim = ndx.dimension(function(d) {return d.date});
        const nameGroup = nameDim.group();
        const opponentGroup = opponentDim.group();
        const dateGroup = dateDim.group();
        

        nameChart
            .dimension(nameDim)
            .group(nameGroup)
            .height(500)
            //.data(function(group) { return group.top(3)})
            //.x(d3.scaleBand())
            //.xUnits(dc.units.ordinal)
            //.title(d => d.opponent)
            ;

        opponentChart
            .dimension(opponentDim)
            .group(opponentGroup)
            .height(500)
            //.elasticX(true)
            //.x(d3.scaleBand())
            //.xUnits(dc.units.ordinal)
            ;

        visCount
            .crossfilter(ndx)
            .group(all);

        visTable
        .dimension(dateDim)
        .section(d => {          
            return `${d.opponent}`;
        })
        .showSections(true)
        .columns([
            "name",
            //"opponent",
            "goals",
            "assists",
            {
                label: 'Starts',
                format: function (d) {
                    if(d.squad === 1) {
                        return "Start";
                    }
                    else {
                        return "Sub";
                    }
                }
            }
        ])
        .size(1000)
        ;
        dc.renderAll();
    });
	</script>
</body>

</html>