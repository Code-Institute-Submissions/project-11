<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>D3 and Scalable Vector Graphics</title>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
		integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.min.css" type="text/css" />

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js">
	</script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3-queue/1.0.7/d3-queue.min.js"></script>
	<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body class="container-fluid">
	<header>
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<a class="navbar-brand" href="#">Navbar</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav">
					<li class="nav-item">
						<a class="nav-link" href="index.html">Intro <span class="sr-only">(current)</span></a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="multi.html">Multi</a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="queue.html">Queue</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="pie-chart.html">Pie</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="line-graphs.html">Line</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="composite-graphs.html">Composite</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="stacked.html">Stacked</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="scatter.html">Scatterplot</a>
					</li>
                    <li class="nav-item">
						<a class="nav-link" href="form.html">Form</a>
					</li>
				</ul>
			</div>
		</nav>
	</header>

	<div class="container-fluid">
		<div class="row">
			<div class="col-12 text-center heading">
				<h1>ESKER <span>CELTIC</span> U13's</h1>
			</div>
		</div>

		<div class="container">
			<div class="row">
				<div class="col-12 col-lg-6">
					<div class="row">
						<div id="attendance-chart"></div>
					</div>
					<div class="row justify-content-center">
						<h5>Match Attendance Start/Sub</h5>
					</div>
					<div class="row">
						<div id="goals-per-person-chart"></div>
					</div>
					<div class="row justify-content-center">
						<h5>Total Goals/Assists Per Person</h5>
					</div>
				</div>
				<div class="col-12 col-lg-6">
					<div class="row">
						<div id="goals-per-opponent-chart"></div>
					</div>
					<div class="row justify-content-center">
						<h5>Total Goals/Assists Per Opponent</h5>
					</div>
					<div class="row">
						<div id="composite-chart"></div>
					</div>
					<div class="row justify-content-center">
						<h5>Ratings Chart</h5>
					</div>
				</div>
			</div>
		</div>
	</div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

	<script>
		queue()
        .defer(d3.json, "data/transactions.json")
        .await(makeGraphs);

        function makeGraphs(error, transactionsData) {
            var ndx = crossfilter(transactionsData);

            
            
        var name_dim = ndx.dimension(dc.pluck('name'));
        var start = name_dim.group().reduceSum(function (d) {
            if (d.squad === 1) {
                return +d.squad;
            } else {
                return 0;
            }
        });

        var sub = name_dim.group().reduceSum(function (d) {
            if (d.squad === 0) {
                return +d.squad+1;
            } else {
                return 0;
            }
        });
        var stackedChart = dc.barChart("#attendance-chart");
        stackedChart
            .width(600)
            .height(150)
            .dimension(name_dim)
            .group(start, "Start")
            .stack(sub, "Sub")
            .x(d3.scale.ordinal())
            .xUnits(dc.units.ordinal)
            .legend(dc.legend().x(555).y(10).itemHeight(15).gap(5))
            .margins({top: 10, right: 50, bottom: 30, left: 50})

            
        var name_dim = ndx.dimension(dc.pluck('name'));
        var total_goals_per_person = name_dim.group().reduceSum(dc.pluck('goals'));
        var total_assists_per_person = name_dim.group().reduceSum(dc.pluck('assists'));

        var stackedChart = dc.barChart('#goals-per-person-chart');
        stackedChart
            .width(600)
            .height(150)
            .margins({top: 10, right: 50, bottom: 30, left: 50})
            .dimension(name_dim)
            .group(total_goals_per_person, "Goals")
            .stack(total_assists_per_person, "Assists")
            .transitionDuration(500)
            .x(d3.scale.ordinal())
            .xUnits(dc.units.ordinal)
            .legend(dc.legend().x(555).y(10).itemHeight(15).gap(5))
            .yAxis().ticks(4);
        
        var opponent_dim = ndx.dimension(dc.pluck('opponent'));
        var total_goals_per_opponent = opponent_dim.group().reduceSum(dc.pluck('goals'));
        var total_assists_per_opponent = opponent_dim.group().reduceSum(dc.pluck('assists'));

        dc.barChart('#goals-per-opponent-chart')
            .width(600)
            .height(150)
            .margins({top: 10, right: 50, bottom: 30, left: 50})
            .dimension(opponent_dim)
            .group(total_goals_per_opponent, "Goals")
            .stack(total_assists_per_opponent, "Assists")
            .transitionDuration(500)
            .x(d3.scale.ordinal())
            .xUnits(dc.units.ordinal)
            .legend(dc.legend().x(560).y(10).itemHeight(15).gap(5))
            .yAxis().ticks(4);

        var parseDate = d3.time.format("%d/%m/%Y").parse;
        transactionsData.forEach(function(d){
            d.date = parseDate(d.date);
        });
        var date_dim = ndx.dimension(dc.pluck('date'));
        var minDate = date_dim.bottom(1)[0].date;
        var maxDate = date_dim.top(1)[0].date;
        function spend_by_name(name) {
            return function(d) {
                if (d.name === name) {
                    return d.rating;
                } else {
                    return 0;
                }
            }
        }
        var jamieSpendByMonth = date_dim.group().reduceSum(spend_by_name('Jamie'));
        var joshfSpendByMonth = date_dim.group().reduceSum(spend_by_name('Josh F')); 
        var joshrSpendByMonth = date_dim.group().reduceSum(spend_by_name('Josh R')); var jamesSpendByMonth = date_dim.group().reduceSum(spend_by_name('James'));
        var jackSpendByMonth = date_dim.group().reduceSum(spend_by_name('Jack'));
        var seanSpendByMonth = date_dim.group().reduceSum(spend_by_name('Sean'));
        var ralphSpendByMonth = date_dim.group().reduceSum(spend_by_name('Ralph'));
        var alexSpendByMonth = date_dim.group().reduceSum(spend_by_name('Alex'));
        var pavanSpendByMonth = date_dim.group().reduceSum(spend_by_name('Pavan'));
        var tadghSpendByMonth = date_dim.group().reduceSum(spend_by_name('Tadgh'));
        var coleSpendByMonth = date_dim.group().reduceSum(spend_by_name('Cole'));
        var leeSpendByMonth = date_dim.group().reduceSum(spend_by_name('Lee'));
        var marcusSpendByMonth = date_dim.group().reduceSum(spend_by_name('Marcus'));
        var saadSpendByMonth = date_dim.group().reduceSum(spend_by_name('Saad'));
        var paulSpendByMonth = date_dim.group().reduceSum(spend_by_name('Paul'));
        var gusSpendByMonth = date_dim.group().reduceSum(spend_by_name('Gus'));

        var compositeChart = dc.compositeChart('#composite-chart');
        compositeChart 
            .width(600)
            .height(150)
            .margins({top: 10, right: 50, bottom: 30, left: 50})
            .dimension(date_dim)
            .x(d3.time.scale().domain([minDate, maxDate]))
            .yAxisLabel("Spend")
            .legend(dc.legend().x(560).y(0).itemHeight(13).gap(5))
            .renderHorizontalGridLines(true)
            .compose([
                dc.lineChart(compositeChart)
                    .colors('green')
                    .group(jamieSpendByMonth, 'Jamie'),
                dc.lineChart(compositeChart)
                    .colors('red')
                    .group(joshfSpendByMonth, 'Josh F'),
                dc.lineChart(compositeChart)
                    .colors('blue')
                    .group(joshrSpendByMonth, 'Josh R'),
                dc.lineChart(compositeChart)
                    .colors('maroon')
                    .group(jackSpendByMonth, 'Jack'),
                dc.lineChart(compositeChart)
                    .colors('yellow')
                    .group(jamesSpendByMonth, 'James'),                
                dc.lineChart(compositeChart)
                    .colors('pink')
                    .group(seanSpendByMonth, 'Sean'),   
                dc.lineChart(compositeChart)
                    .colors('tomato')
                    .group(ralphSpendByMonth, 'Ralph'),     
                dc.lineChart(compositeChart)
                    .colors('orange')
                    .group(alexSpendByMonth, 'Alex'), 
                dc.lineChart(compositeChart)
                    .colors('dodgerblue')
                    .group(pavanSpendByMonth, 'Pavan'), 
                dc.lineChart(compositeChart)
                    .colors('mediumseagreen')
                    .group(tadghSpendByMonth, 'Tadgh'),  
                dc.lineChart(compositeChart)
                    .colors('grey')
                    .group(coleSpendByMonth, 'Cole'),  
                dc.lineChart(compositeChart)
                    .colors('slateblue')
                    .group(leeSpendByMonth, 'Lee'),  
                dc.lineChart(compositeChart)
                    .colors('violet')
                    .group(marcusSpendByMonth, 'Marcus'),  
                dc.lineChart(compositeChart)
                    .colors('lightgrey')
                    .group(leeSpendByMonth, 'Saad'),  
                dc.lineChart(compositeChart)
                    .colors('teal')
                    .group(paulSpendByMonth, 'Paul'),  
                dc.lineChart(compositeChart)
                    .colors('black')
                    .group(gusSpendByMonth, 'Gus'),  
                
            ])
            .brushOn(false)
            .render();
        dc.renderAll();
        }

        
        
	</script>
</body>

</html>